<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√≥dulo de Transacciones - Gu√≠a de Historias de Usuario</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 1.6;
            background: #f5f7fa;
            color: #222;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #ffafbd 0%, #ffc3a0 100%);
            color: #3b1b00;
            padding: 40px 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .header h1 { font-size: 2.5em; margin-bottom: 0.5rem; }
        .header p { font-size: 1.2em; margin: 0.15rem 0; }
        .section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .section h2 {
            color: #ff7a18;
            border-bottom: 3px solid #ff7a18;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            border: 2px solid #ffe4d6;
            border-radius: 8px;
            padding: 20px;
            background: #fff8f2;
        }
        .card h4 { color: #ff7a18; margin-bottom: 10px; }
        .card ul { padding-left: 18px; margin-bottom: 0; }
        .complexity-badge {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin: 5px;
        }
        .simple { background: #d4edda; color: #155724; }
        .medium { background: #fff3cd; color: #856404; }
        .complex { background: #f8d7da; color: #721c24; }
        pre {
            background: #0a151f;
            color: #f5f7ff;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.9em;
        }
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        footer a { color: #ff7a18; text-decoration: none; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üí∏ M√≥dulo de Transacciones (Transaction)</h1>
            <p>Gu√≠a para crear historias de usuario que cubran registro, listado, consulta y reportes.</p>
            <p><strong>Prop√≥sito:</strong> Reproducir la experiencia COBOL con confirmaciones, atajos de teclado y reportes exportables mientras se conecta con un backend Spring Boot.</p>
        </header>

        <section class="section">
            <h2>üìã Resumen del m√≥dulo</h2>
            <p><strong>Contexto de negocio:</strong> Interacci√≥n diaria de agentes con transacciones manuales (correcciones, ajustes, reportes) que deben respetar validaciones de negocio y aprobaciones antes de persistirse.</p>
            <p><strong>Responsabilidades clave:</strong></p>
            <ul>
                <li>Alta segura de transacciones con validaciones frente a `transactionTypeCode`, `transactionAmount`, merchant data y confirmaci√≥n Y/N.</li>
                <li>Listado paginado con atajos F7/F8 y selecci√≥n `'S'` para revisar el detalle.</li>
                <li>Consulta detallada que muestra montos, timestamps y datos de comerciante y permite limpiar/browse.</li>
                <li>Generaci√≥n de reportes (mensual/anual/custom), descarga tipo TXT y visualizaci√≥n con totales y agrupaciones por cuenta.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üéØ Gu√≠a de desarrollo de Historias de Usuario</h2>

            <h3>üìù Templates espec√≠ficos</h3>
            <div class="grid">
                <div class="card">
                    <h4>Agregar transacci√≥n</h4>
                    <p><strong>Patr√≥n:</strong> Como operador, quiero registrar una transacci√≥n con c√≥digos y monto v√°lidos para corregir o insertar cargos.</p>
                    <p><strong>Detalle:</strong> `TransactionAddScreen` desbloquea el bot√≥n `Continue` s√≥lo despu√©s de todas las validaciones y requiere `confirmation = 'Y'` antes del `POST /transactions`.</p>
                </div>
                <div class="card">
                    <h4>Listar y navegar</h4>
                    <p><strong>Patr√≥n:</strong> Como auditor, quiero paginar con F7/F8, buscar por ID y seleccionar `'S'` para abrir el detalle.</p>
                    <p><strong>Detalle:</strong> `TransactionListScreen` hace uso de `useTransactionList`, restricta la selecci√≥n a `S` y dispara la navegaci√≥n `/transactions/view/:id`.</p>
                </div>
                <div class="card">
                    <h4>Consultar detalle</h4>
                    <p><strong>Patr√≥n:</strong> Como analista, quiero ver los timestamps originales y procesados junto con merchant info sin perder el ID.</p>
                    <p><strong>Detalle:</strong> `TransactionViewScreen` utiliza `useTransactionView` y su `handleInitialLoad` para rellenar autom√°ticamente si se llega desde la lista.</p>
                </div>
                <div class="card">
                    <h4>Generar reporte</h4>
                    <p><strong>Patr√≥n:</strong> Como controller financiero, quiero generar reportes mensuales o por rango, confirmar la operaci√≥n y descargarlo.</p>
                    <p><strong>Detalle:</strong> `TransactionReportsScreen` valida fechas, fuerza `confirmation` y abre un `<Dialog>` con `TransactionReportTable` + botones `Download TXT`/`Print`.</p>
                </div>
            </div>

            <h3>‚ö° Factores de aceleraci√≥n</h3>
            <ul>
                <li><strong>Hooks reutilizables:</strong> `useTransactionAdd/List/View/Reports` encapsulan validaciones, transformaciones y navegaci√≥n para que los componentes s√≥lo consuman callbacks.</li>
                <li><strong>SystemHeader + Material UI:</strong> la cabecera (CT00/CT01/CT02/CR00) y los patrones `Box`, `Grid`, `Paper`, `Table` facilitan replicar el look & feel de CLI.</li>
                <li><strong>Paneles de desarrollo:</strong> `testData`, `validationHelp` y `requestPreview` aceleran pruebas manuales sin cambiar el backend.</li>
                <li><strong>Report Table + utilidades:</strong> `TransactionReportTable` aplica `formatCurrency` y `formatDateTime` para mostrar totales por cuenta y un gran total con chips de estado.</li>
            </ul>

            <h3>üìä Gu√≠a de complejidad</h3>
            <div>
                <span class="complexity-badge simple">Simple</span>
                <span class="complexity-badge medium">Medio</span>
                <span class="complexity-badge complex">Complejo</span>
            </div>
            <ul>
                <li><strong>Simple (1-2 pts):</strong> Agregar ayuda contextual (chips, helper text) a `TransactionAddScreen` reutilizando el hook.</li>
                <li><strong>Medio (3-5 pts):</strong> Soportar filtros adicionales en la lista (por fecha o categor√≠a) manteniendo la l√≥gica de paginado y selecci√≥n.</li>
                <li><strong>Complejo (5-8 pts):</strong> Crear una exportaci√≥n en PDF real y registrar auditor√≠a/telemetr√≠a en los reportes con nuevo endpoint.</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Fundaci√≥n t√©cnica</h2>

            <h3>üèóÔ∏è Componentes clave</h3>
            <div class="grid">
                <div class="card">
                    <h4>TransactionAddScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Renderizar formulario agrupado por m√≥dulos (identificaci√≥n, detalles, merchant) con paneles de ayuda y confirmaci√≥n antes del env√≠o.</p>
                </div>
                <div class="card">
                    <h4>TransactionListScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Mostrar tabla con montos (colores para positivos/negativos), selecci√≥n `'S'`, atajos F3/F7/F8 y `SystemHeader` con `COTRN00C`.</p>
                </div>
                <div class="card">
                    <h4>TransactionViewScreen.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Visualizar atributos, fechas y merchant info, limpiar con F4 y navegar a la lista con F5.</p>
                </div>
                <div class="card">
                    <h4>TransactionReportsScreen.tsx + TransactionReportTable.tsx</h4>
                    <p><strong>Responsabilidad:</strong> Validar tipo de reporte, confirmar (Y/N), abrir di√°logo con tabla agrupada y opciones de descarga/imprimir.</p>
                </div>
                <div class="card">
                    <h4>Hooks `useTransaction*`</h4>
                    <p><strong>Responsabilidad:</strong> Orquestan las llamadas a `apiClient`, validan campos, gestionan errores y exponen m√©todos como `handleSearch`, `handleSubmit`, `handleNextPage`.</p>
                </div>
            </div>

            <h3>üîó Dependencias</h3>
            <ul>
                <li><strong>`SystemHeader`, `alpha(theme)` y componentes MUI:</strong> asegurando layout coherente con otros m√≥dulos.</li>
                <li><strong>`apiClient` + `useMutation`:</strong> base reusable para todas las llamadas HTTP.</li>
                <li><strong>`app/mocks/transaction*Handlers.ts` + `validate-mocks.sh`:</strong> permiten pruebas locales con MSW y validaciones automatizadas.</li>
                <li><strong>`menuData.ts`:</strong> expone rutas `/transactions/add`, `/transactions/list`, `/transactions/view`, `/transactions/reports` dentro del men√∫ principal.</li>
            </ul>

            <h3>üåê Interfaces p√∫blicas</h3>
            <pre><code>
POST /transactions
POST /transactions/list
POST /transactions/next-page
POST /transactions/previous-page
GET  /transaction-view/search?transactionId={id}
POST /transaction/clear
POST /v1/reports/transactions/monthly
POST /v1/reports/transactions/yearly
POST /v1/reports/transactions/custom
            </code></pre>
        </section>

        <footer>
            <p><a href="../index.html">‚Üê Volver al √≠ndice general</a></p>
            <p><em>√öltima actualizaci√≥n: 2026-02-14 ¬∑ Documento inspirado en TEMPLATE_DOC.txt</em></p>
        </footer>
    </div>
</body>
</html>
